<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Panorama Viewer</title>
    <!-- EasyUI CSS -->
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/default/easyui.css">
    <link rel="stylesheet" type="text/css" href="https://www.jeasyui.com/easyui/themes/icon.css">
    <!-- Pannellum CSS -->
    <link rel="stylesheet" href="lib/Pannellum2_5_6/pannellum.css"/>

    <!-- jQuery and EasyUI JS -->
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.min.js"></script>
    <script type="text/javascript" src="https://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    <!-- Pannellum JS -->
    <script type="text/javascript" src="lib/Pannellum2_5_6/pannellum.js"></script>
    <script type="text/javascript" src="lib/Pannellum2_5_6/libpannellum.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #main-layout {
            width: 100%;
            height: 100vh;
        }
        #west-panel {
            padding: 10px;
            overflow: hidden;
        }
        #canvas-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        #canvas {
            width: 100%;
            height: 100%;
        }
        .control-group {
            margin: 15px 0;
        }
        .control-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .btn-group {
            margin-top: 20px;
        }
        .btn-group button {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        #file-list-container {
            margin-top: 20px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background: #f9f9f9;
        }
        .file-item {
            padding: 5px 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .file-item:hover {
            background: #e6f2ff;
        }
        .file-item.folder {
            font-weight: bold;
            color: #0066cc;
        }
        .file-item.image {
            color: #333;
        }
        .file-item.current {
            background: #d9edf7;
            border-left: 3px solid #31708f;
        }
        .breadcrumb {
            padding: 5px 10px;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
            font-size: 12px;
        }
        .breadcrumb a {
            color: #0066cc;
            text-decoration: none;
            cursor: pointer;
        }
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        .file-actions {
            padding: 5px 10px;
            background: #f0f0f0;
            border-bottom: 1px solid #ddd;
        }
        #file-search {
            width: 100%;
            box-sizing: border-box;
            padding: 3px;
        }
        #file-list {
            height: 300px;
            overflow-y: auto;
            overflow-x: hidden;
        }
    </style>
</head>
<body>
    <div id="main-layout" class="easyui-layout">
    <!-- –ó–∞–ø–∞–¥–Ω–∞—è –ø–∞–Ω–µ–ª—å (30%) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div id="west-panel" data-options="region:'west',title:'Controls',split:true" style="width:30%;">
	    <div style="background: #f0f0f0; padding: 5px 10px; border-bottom: 1px solid #ddd; flex-shrink:0;">
	    	<label style="margin: 0; display: inline-block;">File Browser</label>
	    	<div style="float: right;">
	    		<button class="easyui-linkbutton" onclick="loadFileList()" style="padding: 2px 8px; font-size: 11px;">Refresh</button>
	    	</div>
	    </div>

	    <div class="file-actions" style="flex-shrink:0;">
	    	<input id="file-search" type="text" placeholder="Search files..." onkeyup="filterFiles()" style="width:100%; box-sizing:border-box;">
	    </div>

	    <div class="breadcrumb" id="breadcrumb" style="flex-shrink:0;">
	    	<a onclick="navigateToFolder('')">Home</a>
	    </div>

	    <div id="file-list" style="flex:1; overflow-y:auto; min-height:0;">
	    	<p style="padding: 10px; text-align: center; color: #999;">
	    		Loading files...
	    	</p>
	    </div>
	</div>
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å (70%) –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º—ã -->
        <div data-options="region:'center',title:'Panorama Viewer',noheader:true,split:true" style="padding:0;">
            <div id="canvas-container">
                <div id="canvas"></div>
            </div>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –∫–∞—Ä—Ç—ã (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ–µ) -->
    <div id="w_map" class="easyui-window" title="Map"
         data-options="modal:false,closed:true,resizable:false"
         style="width:500px;height:400px;padding:5px;">
        <div id="basicMap">Map content here</div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        var sceneMain = null;
        var scenesData = {};
        var currentScene = null;
        var currentFolder = '';
        var allFiles = [];
        var fileListResizing = false;
		var baseUrl = window.location.origin + window.location.pathname;
		// –£–±–µ—Ä–∏—Ç–µ index.html –∏–∑ –ø—É—Ç–∏ –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
		if (baseUrl.endsWith('index.html')) {
			baseUrl = baseUrl.substring(0, baseUrl.lastIndexOf('/') + 1);
		}

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        $(document).ready(function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è layout
            $('#main-layout').layout();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–π —Å—Ü–µ–Ω—ã
            loadInitialScene();

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
            loadFileList();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –ø–∞–Ω–µ–ª–∏ —Ñ–∞–π–ª–æ–≤
            initFileListResize();

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ layout –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            $(window).resize(function() {
                $('#main-layout').layout('resize');
                if (sceneMain) {
                    sceneMain.resize();
                }
            });
        });

        function initFileListResize() {
            var resizeHandle = document.getElementById('file-list-resize');
            var fileList = document.getElementById('file-list');
            var startY, startHeight;

            resizeHandle.addEventListener('mousedown', initResize, false);

            function initResize(e) {
                startY = e.clientY;
                startHeight = parseInt(document.defaultView.getComputedStyle(fileList).height, 10);
                fileListResizing = true;

                document.documentElement.addEventListener('mousemove', doResize, false);
                document.documentElement.addEventListener('mouseup', stopResize, false);
            }

            function doResize(e) {
                if (!fileListResizing) return;

                var deltaY = e.clientY - startY;
                var newHeight = startHeight + deltaY;

                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É
                if (newHeight < 100) newHeight = 100;
                if (newHeight > 500) newHeight = 500;

                fileList.style.height = newHeight + 'px';
            }

            function stopResize() {
                fileListResizing = false;
                document.documentElement.removeEventListener('mousemove', doResize, false);
                document.documentElement.removeEventListener('mouseup', stopResize, false);
            }
        }

        function loadInitialScene() {
            scenesData = {
                'default': {
                    name: 'Default Scene',
                    config: {
                        "default": {
                            "firstScene": "scene1"
                        },
                        "scenes": {
                            "scene1": {
                                "title": "Default Panorama",
                                // –§–∏–∑–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ: img/DSCN0129.JPG
                                // –í–µ–±-–ø—É—Ç—å: DSCN0129.JPG (–±–µ–∑ img/)
                                "panorama": "DSCN0129.JPG",
                                "crossOrigin": "use-credentials",
                                "autoLoad": true,
                                "yaw": -6.77,
                                "pitch": -24.41,
                                "hotSpots": []
                            }
                        }
                    }
                }
            };

            setSelectPanorama();
            updateSceneList();
        }

        function loadFileList(folder) {
            if (folder !== undefined) {
                currentFolder = folder;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            $('#file-list').html('<p style="padding: 10px; text-align: center; color: #999;">Loading files...</p>');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ PHP —Å–∫—Ä–∏–ø—Ç—É
            $.ajax({
                url: 'get_files.php',
                type: 'POST',
                data: {
                    folder: currentFolder,
                    extensions: 'jpg,jpeg,png,gif'
                },
                dataType: 'json',
                success: function(response) {
                    if (response.success) {
                        allFiles = response.files;
                        displayFiles(response.files);
                        updateBreadcrumb();
                    } else {
                        $('#file-list').html('<p style="padding: 10px; text-align: center; color: #f00;">Error: ' + response.error + '</p>');
                    }
                },
                error: function(xhr, status, error) {
                    $('#file-list').html('<p style="padding: 10px; text-align: center; color: #f00;">Failed to load files: ' + error + '</p>');
                }
            });
        }

        function displayFiles(files) {
            var html = '';

            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–ø–∫–∏
            files.forEach(function(file) {
                if (file.type === 'folder') {
                    html += `
                        <div class="file-item folder" onclick="navigateToFolder('${file.path}')">
                            <span style="margin-right: 5px;">üìÅ</span>
                            ${file.name}
                            <span style="float: right; color: #999; font-size: 11px;">folder</span>
                        </div>
                    `;
                }
            });

			// –ó–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
			files.forEach(function(file) {
				if (file.type === 'image') {
					var isCurrent = (currentScene === file.name) ? ' current' : '';
					// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω—ã–π –ø—É—Ç—å —Å –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–æ–º
					var fullPath = file.path; // –ò—Å–ø–æ–ª—å–∑—É–µ–º path –≤–º–µ—Å—Ç–æ name –¥–ª—è —É—á–µ—Ç–∞ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–æ–≤

					html += `
						<div class="file-item image${isCurrent}" onclick="loadImage('${fullPath}')"
							 title="${file.name} (${file.size})">
							<span style="margin-right: 5px;">üñºÔ∏è</span>
							${file.name}
							<span style="float: right; color: #999; font-size: 11px;">${file.size}</span>
						</div>
					`;
				}
			});

            if (html === '') {
                html = '<p style="padding: 10px; text-align: center; color: #999;">No files found</p>';
            }

            $('#file-list').html(html);
        }

        function updateBreadcrumb() {
            var breadcrumbHtml = '<a onclick="navigateToFolder(\'\')">Home</a>';

            if (currentFolder) {
                var parts = currentFolder.split('/').filter(Boolean);
                var currentPath = '';

                parts.forEach(function(part, index) {
                    currentPath += (currentPath ? '/' : '') + part;
                    breadcrumbHtml += ' &gt; ';

                    if (index === parts.length - 1) {
                        breadcrumbHtml += '<span>' + part + '</span>';
                    } else {
                        breadcrumbHtml += '<a onclick="navigateToFolder(\'' + currentPath + '\')">' + part + '</a>';
                    }
                });
            }

            $('#breadcrumb').html(breadcrumbHtml);
        }

		function navigateToFolder(folderPath) {
			// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø—É—Ç—å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç ".."
			if (folderPath.indexOf('..') !== -1) {
				console.error('Invalid folder path');
				return;
			}
			loadFileList(folderPath);
		}

        function filterFiles() {
            var searchTerm = $('#file-search').val().toLowerCase();

            if (!searchTerm) {
                displayFiles(allFiles);
                return;
            }

            var filteredFiles = allFiles.filter(function(file) {
                return file.name.toLowerCase().includes(searchTerm);
            });

            displayFiles(filteredFiles);
        }

		function loadImage(imageName) {
			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ imageName –ø—É—Ç—å
			// –ï—Å–ª–∏ imageName —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, "folder/DSCN0021.JPG"), –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
			// –ï—Å–ª–∏ –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É
			var fullImagePath = imageName;

			// –ï—Å–ª–∏ –∏–º—è —Ñ–∞–π–ª–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Ç–∏, –¥–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞–ø–∫—É
			if (imageName.indexOf('/') === -1 && currentFolder) {
				fullImagePath = currentFolder + '/' + imageName;
			}

			// –î–ª—è –≤–µ–±-–¥–æ—Å—Ç—É–ø–∞ –¥–æ–±–∞–≤–ª—è–µ–º "img/" –≤ –Ω–∞—á–∞–ª–æ
			var webImagePath = 'img/' + fullImagePath;

			// –û–±–Ω–æ–≤–ª—è–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º photo
			var url = new URL(window.location.href);
			url.searchParams.set('photo', webImagePath);
			window.history.pushState({}, '', url);

			// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–Ω–æ—Ä–∞–º–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫
			setSelectPanorama({image: webImagePath});

			// –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
			$('.file-item').removeClass('current');
			$(event.target).closest('.file-item').addClass('current');
		}

        function setSelectPanorama(hotSpot) {
            let params = new URLSearchParams(document.location.search);
            let infoValue = params.get('info');
            let photoValue = params.get('photo');

            let canvas = document.getElementById('canvas');
            canvas.style.width = '100%';
            canvas.style.height = '100%';

			// –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä photo, –∑–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
			if (photoValue) {
				// –í–µ–±-–ø—É—Ç—å: —Ç–æ–ª—å–∫–æ –∏–º—è —Ñ–∞–π–ª–∞ (DSCN0021.JPG) - –ò–°–ü–†–ê–í–ò–¢–¨ –≠–¢–û
				var imageUrl = photoValue;

				// –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞:
				var imageUrl = photoValue; // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å, —Ç–∞–∫ –∫–∞–∫ photoValue —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Ç—å

                let jsonObj = {
                    "hotSpotDebug": false,
                    "hotPointDebug": true,
                    "sceneFadeDuration": 1000,
                    "default": {
                        "firstScene": "scene1"
                    },
                    "scenes": {
                        "scene1": {
                            "title": "Image: " + photoValue,
                            "panorama": imageUrl, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
                            "crossOrigin": "use-credentials",
                            "autoLoad": true,
                            "yaw": 0,
                            "pitch": 0,
                            "hotSpots": []
                        }
                    }
                };
                jsonObj.onClickHotSpot = onClickHotSpot;
                jsonObj.onGetMapWindow = onGetMapWindow;

                if (sceneMain && typeof sceneMain['destroy'] !== 'undefined') {
                    sceneMain.destroy();
                }
                sceneMain = pannellum.viewer('canvas', jsonObj);
                currentScene = photoValue;
            }
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä info, –∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            else if (infoValue) {
                let jsonObj = getJsonUrlData('/Example/pano360/point_info/' + infoValue);
                jsonObj.onClickHotSpot = onClickHotSpot;
                jsonObj.onGetMapWindow = onGetMapWindow;

                if (sceneMain && typeof sceneMain['destroy'] !== 'undefined') {
                    sceneMain.destroy();
                }
                sceneMain = pannellum.viewer('canvas', jsonObj);
                currentScene = infoValue;
            }
            // –ï—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            else {
                // –í–µ–±-–ø—É—Ç—å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                var defaultImage = 'DSCN0129.JPG';

                let jsonObj = {
                    "hotSpotDebug": false,
                    "hotPointDebug": true,
                    "sceneFadeDuration": 1000,
                    "default": {
                        "firstScene": "scene1"
                    },
                    "scenes": {
                        "scene1": {
                            "title": "Default Panorama",
                            "panorama": defaultImage,
                            "crossOrigin": "use-credentials",
                            "autoLoad": true,
                            "yaw": -6.77,
                            "pitch": -24.41,
                            "hotSpots": []
                        }
                    }
                };
                jsonObj.onClickHotSpot = onClickHotSpot;
                jsonObj.onGetMapWindow = onGetMapWindow;

                if (sceneMain && typeof sceneMain['destroy'] !== 'undefined') {
                    sceneMain.destroy();
                }
                sceneMain = pannellum.viewer('canvas', jsonObj);
                currentScene = 'default';
            }

            updateViewInfo();
        }

        function onClickHotSpot(hs) {
            const jsonName = hs['panorama_url']?.split('/')[4];
            if (jsonName) {
                const name = jsonName.split('.')[0];

                let currentUrl = new URL(window.location.href);
                if (!currentUrl.searchParams.get('info')) {
                    currentUrl.searchParams.append('info', hs.panorama_url.split('/')[4]);
                } else {
                    currentUrl.searchParams.set('info', hs.panorama_url.split('/')[4]);
                }
                window.history.pushState({}, '', currentUrl);

                let jsonObj = getJsonUrlData(hs['panorama_url']);
                jsonObj.onClickHotSpot = onClickHotSpot;
                jsonObj.onGetMapWindow = onGetMapWindow;
                jsonObj['pitch'] = hs['point_pitch'];
                jsonObj['yaw'] = hs['point_yaw'];

                if (sceneMain && typeof sceneMain['destroy'] !== 'undefined') {
                    sceneMain.destroy();
                }
                sceneMain = pannellum.viewer('canvas', jsonObj);
                currentScene = name;

                updateViewInfo();
                return true;
            }
            return false;
        }

        function onGetMapWindow() {
            $('#w_map').window('open');
        }

        function updateSceneList() {
            let sceneListHtml = '';
            for (let sceneId in scenesData) {
                sceneListHtml += `
                    <div style="margin:5px 0;padding:5px;background:#f5f5f5;border-radius:3px;">
                        <strong>${scenesData[sceneId].name}</strong>
                        <button class="easyui-linkbutton" onclick="loadScene('${sceneId}')"
                                style="float:right;padding:2px 8px;font-size:12px;">
                            Load
                        </button>
                    </div>
                `;
            }
            $('#scene-list').html(sceneListHtml || '<p>No scenes available</p>');
        }

        function loadScene(sceneId) {
            if (scenesData[sceneId] && sceneMain) {
                sceneMain.loadScene(sceneId);
                currentScene = sceneId;
                updateViewInfo();
            }
        }

        function zoomIn() {
            if (sceneMain) {
                sceneMain.setHfov(sceneMain.getHfov() - 5);
                updateViewInfo();
            }
        }

        function zoomOut() {
            if (sceneMain) {
                sceneMain.setHfov(sceneMain.getHfov() + 5);
                updateViewInfo();
            }
        }

        function resetView() {
            if (sceneMain) {
                sceneMain.lookAt(0, 0, 100, 1000);
                updateViewInfo();
            }
        }

        function toggleMap() {
            $('#w_map').window('toggle');
        }

        function fullscreen() {
            if (sceneMain) {
                sceneMain.toggleFullscreen();
            }
        }

        function refreshViewer() {
            if (sceneMain) {
                sceneMain.destroy();
                setSelectPanorama();
            }
        }

        function updateViewInfo() {
            if (sceneMain) {
                $('#pitch-info').text('Pitch: ' + sceneMain.getPitch().toFixed(2) + '¬∞');
                $('#yaw-info').text('Yaw: ' + sceneMain.getYaw().toFixed(2) + '¬∞');
                $('#hfov-info').text('HFOV: ' + sceneMain.getHfov().toFixed(2) + '¬∞');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getJsonUrlData(url, data) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url, false);
            xhr.send(data);
            if (xhr.status != 200) {
                console.error(xhr.status + ': ' + xhr.statusText + ' (' + url + ')');
                return {'error': xhr.status + ' : ' + xhr.statusText};
            } else {
                return JSON.parse(xhr.response);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–µ–π
        var orientation_roll = 0;
        var orientation_azimuth = 0;
        var pitchOld = 0;
        var yawOld = 0;
        var oldX = 0;
        var oldY = 0;

        function changePitch(value) {
            if (sceneMain) {
                var x = value * (-1);
                x = x - 45;
                if (oldX == 0) {
                    oldX = sceneMain.getPitch();
                }
                x = x + oldX;
                sceneMain.setPitch(x, 100);
                updateViewInfo();
            }
        }

        function changeAzimuth(value) {
            if (sceneMain) {
                var y = value;
                y = y - 180;
                if (oldY == 0) {
                    oldY = sceneMain.getYaw();
                }
                sceneMain.setYaw(y, 100);
                updateViewInfo();
            }
        }

        function defineProperty(propertyName, defaultValue, callback) {
            Object.defineProperty(window, propertyName, {
                get() {
                    return defaultValue;
                },
                set(v) {
                    if (callback) callback(v);
                    defaultValue = v;
                }
            });
        }

        defineProperty('orientation_azimuth', {}, changeAzimuth);
        defineProperty('orientation_roll', {}, changePitch);
    </script>
</body>
</html>